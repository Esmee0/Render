<!DOCTYPE html>
<html>
<head>
  <title>Mini Tesla Auto Dashboard</title>
  <style>
body {
  background: #181a1d;
  color: #eee;
  font-family: 'Segoe UI', 'Roboto', sans-serif;
  min-height: 100vh;
  margin: 0;
  display: flex; flex-direction: column; align-items: center;
}
h1 {
  text-align: center;
  margin: 2.5rem 0 2rem 0;
  color: #3ed6fa;
  font-size: 2.5rem;
  letter-spacing: 0.02em;
  font-weight: 700;
  text-shadow: 0 6px 30px #000c;
}
#tesla-car-wrapper {
  background: #21252b;
  border-radius: 1.7rem;
  box-shadow: 0 6px 30px #0196df26;
  padding: 2rem 3rem 2.2rem 3rem;
  display: flex; flex-direction: column; align-items: center;
  margin: 2rem 0 1rem 0;
  min-width: 260px;
}
.tesla-car-svg {
  width: 180px;
  height: 86px;
  margin-bottom: 1.16rem;
  display: block;
}
.status-box {
  text-align: center;
  margin: 0.8rem 0 0 0;
  font-size: 1.2rem;
  font-weight: 500;
  letter-spacing: 0.01em;
  min-height: 1.8em;
}
.status-box.obstacle { color: #ff4848; }
.status-box.moving { color: #39ffb2; }
.status-box.waiting { color: #ffd700; }
#last-seen, #ping-count {
  font-size: 0.95em;
  margin: 0.35em 0;
  color: #95d5e7;
  text-align: center;
}
  </style>
</head>
<body>
<h1>Relayrace dashboard</h1>
<div id="tesla-car-wrapper">
  <!-- Minimalistische Tesla-style auto SVG -->
  <svg class="tesla-car-svg" viewBox="0 0 180 86" fill="none">
    <!-- Car shadow -->
    <ellipse cx="90" cy="80" rx="65" ry="6" fill="#232c33" opacity="0.21"/>
    <!-- Car base -->
    <rect x="27" y="44" width="126" height="23" rx="11" id="car-body-outline" fill="#15171a"/>
    <rect x="30" y="42" width="120" height="19" rx="9" id="car-body" fill="#23bffe"/>
    <!-- Windshield -->
    <rect x="75" y="37" width="30" height="13" rx="6.5" id="car-glass" fill="#fff" fill-opacity="0.72"/>
    <!-- Left wheel -->
    <circle cx="47" cy="72" r="12" fill="#222" stroke="#111" stroke-width="3"/>
    <!-- Right wheel -->
    <circle cx="133" cy="72" r="12" fill="#222" stroke="#111" stroke-width="3"/>
    <!-- Headlights -->
    <ellipse cx="31" cy="53" rx="4" ry="2" fill="#fffbe0" id="left-light" />
    <ellipse cx="148" cy="53" rx="4" ry="2" fill="#fffbe0" id="right-light" />
  </svg>
  <div class="status-box" id="robot-status">Wachten op data...</div>
  <div id="last-seen"></div>
  <div id="ping-count"></div>
</div>
<script>
async function fetchRobots() {
    const res = await fetch("/api/robots");
    const robots = await res.json();
    if (robots.length === 0) {
        document.getElementById('robot-status').textContent = "Robot offline";
        document.getElementById('car-body').setAttribute('fill', '#999');
        document.getElementById('car-glass').setAttribute('fill', '#cccccc');
        document.getElementById('left-light').setAttribute('fill', '#adacac');
        document.getElementById('right-light').setAttribute('fill', '#adacac');
        document.getElementById('last-seen').textContent = "";
        document.getElementById('ping-count').textContent = "";
        return;
    }
    const r = robots[0];
    let status = r.last_data?.toLowerCase() || "";
    const statusDiv = document.getElementById('robot-status');
    if (status.includes("obstacle")) {
        statusDiv.textContent = r.last_data;
        statusDiv.className = "status-box obstacle";
        document.getElementById('car-body').setAttribute('fill', '#ff4848');
        document.getElementById('car-glass').setAttribute('fill', '#ffd7c0');
        document.getElementById('left-light').setAttribute('fill', '#ffe3d6');
        document.getElementById('right-light').setAttribute('fill', '#ffe3d6');
    } else if (status.includes("wait")) {
        statusDiv.textContent = r.last_data;
        statusDiv.className = "status-box waiting";
        document.getElementById('car-body').setAttribute('fill', '#ffd700');
        document.getElementById('car-glass').setAttribute('fill', '#fffbe4');
        document.getElementById('left-light').setAttribute('fill', '#fffbe0');
        document.getElementById('right-light').setAttribute('fill', '#fffbe0');
    } else if(status) {
        statusDiv.textContent = r.last_data;
        statusDiv.className = "status-box moving";
        document.getElementById('car-body').setAttribute('fill', '#23bffe');
        document.getElementById('car-glass').setAttribute('fill', '#fff');
        document.getElementById('left-light').setAttribute('fill', '#fffbe0');
        document.getElementById('right-light').setAttribute('fill', '#fffbe0');
    } else {
        statusDiv.textContent = "Geen status ontvangen";
        statusDiv.className = "status-box";
        document.getElementById('car-body').setAttribute('fill', '#666');
        document.getElementById('car-glass').setAttribute('fill', '#cccccc');
        document.getElementById('left-light').setAttribute('fill', '#adacac');
        document.getElementById('right-light').setAttribute('fill', '#adacac');
    }
    document.getElementById('last-seen').textContent = 'Laatste ping: ' + (r.last_seen ? new Date(r.last_seen).toLocaleString() : '-');
    document.getElementById('ping-count').textContent = 'Aantal pings: ' + r.ping_count;
}
fetchRobots();
setInterval(fetchRobots, 1500);
</script>
</body>
</html>